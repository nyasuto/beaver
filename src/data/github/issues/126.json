{
  "id": 3218970754,
  "node_id": "I_kwDOPJEskc6_3ZiC",
  "number": 126,
  "title": "🧪 テストカバレージ80%達成のための包括的テスト実装計画",
  "body": "## 🎯 テストカバレージ80%達成のための現実的なテスト実装計画\n\n### **Priority: HIGH**\n\n**Impact:** プロジェクト全体の品質向上とメンテナンス性向上  \n**Component:** TypeScript実装コードのテストインフラストラクチャ  \n**Files:** src/lib/**, src/components/charts/**, src/pages/api/**\n\n### 問題の背景\n\n現在のテストカバレージは54.49%で、80%の目標まで25.51%の向上が必要です。\n\n#### 現在の状況分析（修正版）\n- **全体カバレージ**: 54.49% (目標: 80%)\n- **テスト済みファイル**: 46個のテストファイル（1620個のテスト）\n- **Astroファイル**: カバレッジ計測対象外（レイアウトエンジンのため）\n- **実際のテスト対象**: TypeScript/JSXファイルのみ\n\n#### 主要な未カバレッジエリア（テスト対象のみ）\n\n**1. 未テストのスキーマ・設定ファイル (0% カバレッジ)**\n```\nsrc/lib/schemas/analytics.ts      (0% - 352行)\nsrc/lib/schemas/index.ts          (0% - 290行)\nsrc/lib/schemas/processing.ts     (0% - 491行)\nsrc/lib/schemas/validation.ts     (0% - 498行)\nsrc/lib/analytics/data-adapter.ts (0% - 317行)\nsrc/lib/analytics/index.ts        (0% - 113行)\nsrc/lib/types/index.ts            (0% - 全体)\n```\n\n**2. 部分的カバレッジの重要ファイル**\n```\nsrc/lib/utils/url.ts              (54.54% - 22-36,45-46行未テスト)\nsrc/lib/github/client.ts          (86.12% - 26,279-288,296行未テスト)\nsrc/lib/github/index.ts           (78.26% - 112-122行未テスト)\nsrc/lib/schemas/github.ts         (91.91% - 関数カバレッジ25%)\nsrc/lib/schemas/ui.ts             (89.59% - 460-461,468-506行未テスト)\nsrc/lib/analytics/config.ts       (90.66% - 83-84,136-138行未テスト)\n```\n\n**3. チャートコンポーネント（関数カバレッジ改善必要）**\n```\nsrc/components/charts/PieChart.tsx     (67.08% - 関数カバレッジ33%)\nsrc/components/charts/BarChart.tsx     (86.11% - 関数カバレッジ44%)\nsrc/components/charts/LineChart.tsx    (93.1% - 関数カバレッジ40%)\nsrc/components/charts/AreaChart.tsx    (91.3% - 関数カバレッジ50%)\n```\n\n### 現実的な実装計画\n\n#### フェーズ1: 高インパクト・低コストのテスト実装 (優先度: CRITICAL)\n**目標カバレッジ向上: +15%**\n\n- [ ] **未テストスキーマファイル** (1日で実装可能)\n  - analytics.ts, index.ts, processing.ts, validation.ts\n  - 主にZodスキーマの検証テスト\n  - 1,648行のコードを一気にカバレッジ向上\n\n- [ ] **ユーティリティファイル完全テスト** (0.5日)\n  - lib/utils/url.ts の残り45.46%\n  - lib/types/index.ts の型定義テスト\n\n#### フェーズ2: ビジネスロジックのテスト完成 (優先度: HIGH)\n**目標カバレッジ向上: +7%**\n\n- [ ] **GitHub API関連の完全テスト** (1日)\n  - lib/github/client.ts (86.12% → 95%+)\n  - lib/github/index.ts (78.26% → 95%+)\n  - lib/schemas/github.ts (関数カバレッジ25% → 80%+)\n\n- [ ] **アナリティクス関連** (1日)\n  - lib/analytics/data-adapter.ts (0% → 80%+)\n  - lib/analytics/index.ts (0% → 80%+)\n  - lib/analytics/config.ts (90.66% → 95%+)\n\n#### フェーズ3: チャートコンポーネントのエッジケース (優先度: MEDIUM)\n**目標カバレッジ向上: +3%**\n\n- [ ] **関数カバレッジ向上** (1日)\n  - PieChart.tsx (関数カバレッジ 33% → 70%+)\n  - BarChart.tsx (関数カバレッジ 44% → 70%+)\n  - LineChart.tsx (関数カバレッジ 40% → 70%+)\n\n### 技術的実装戦略\n\n#### 1. スキーマテストパターン\n```typescript\n// Zodスキーマの包括的テスト\ndescribe('Schema Validation', () => {\n  it('should validate valid data', () => {\n    const validData = { /* ... */ };\n    expect(() => Schema.parse(validData)).not.toThrow();\n  });\n  \n  it('should reject invalid data', () => {\n    const invalidData = { /* ... */ };\n    expect(() => Schema.parse(invalidData)).toThrow();\n  });\n});\n```\n\n#### 2. ユーティリティ関数のエッジケース\n```typescript\n// URL処理、型チェック、バリデーション関数\ndescribe('Edge Cases', () => {\n  it('should handle empty input', () => {});\n  it('should handle malformed data', () => {});\n  it('should handle network errors', () => {});\n});\n```\n\n#### 3. 効率的なテスト実装\n- **既存のモックデータ活用**: `src/lib/github/__mocks__/data.ts`\n- **共通テストユーティリティ**: `src/test/setup.ts`\n- **パラメータ化テスト**: 複数のケースを効率的にテスト\n\n### 現実的な成功指標\n\n#### 段階別カバレッジ目標\n- **フェーズ1完了**: 54.49% → 69.49% (+15%)\n- **フェーズ2完了**: 69.49% → 76.49% (+7%)\n- **フェーズ3完了**: 76.49% → 79.49% (+3%)\n- **最終目標**: 80%+ (微調整で達成)\n\n#### 実装スケジュール\n- **Week 1**: フェーズ1 (スキーマ・ユーティリティ)\n- **Week 2**: フェーズ2 (GitHub API・アナリティクス)\n- **Week 3**: フェーズ3 (チャートコンポーネント)\n- **Week 4**: 最終調整・リファクタリング\n\n### 重要な方針変更\n\n**❌ 除外したもの:**\n- Astroファイル (レイアウトエンジンとして機能、テスト不要)\n- 設定ファイル (.eslintrc.cjs等)\n- モックファイル (テスト用データ)\n\n**✅ 集中対象:**\n- ビジネスロジック (lib/*)\n- API エンドポイント (pages/api/*)\n- チャートコンポーネント (components/charts/*)\n\n**このアプローチにより、最小限の工数で最大のカバレッジ向上を実現し、実際のコード品質向上に直結します。**",
  "user": {
    "login": "nyasuto",
    "id": 17446383,
    "node_id": "MDQ6VXNlcjE3NDQ2Mzgz",
    "avatar_url": "https://avatars.githubusercontent.com/u/17446383?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nyasuto",
    "html_url": "https://github.com/nyasuto",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 8910603282,
      "node_id": "LA_kwDOPJEskc8AAAACEx0EEg",
      "name": "priority: high",
      "description": "High priority tasks",
      "color": "f85149",
      "default": false
    },
    {
      "id": 8910603599,
      "node_id": "LA_kwDOPJEskc8AAAACEx0FTw",
      "name": "type: test",
      "description": "Test related tasks",
      "color": "f9d71c",
      "default": false
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 0,
  "created_at": "2025-07-10T11:28:21Z",
  "updated_at": "2025-07-10T13:00:08Z",
  "closed_at": "2025-07-10T13:00:08Z",
  "author_association": "OWNER",
  "active_lock_reason": null,
  "html_url": "https://github.com/nyasuto/beaver/issues/126",
  "url": "https://api.github.com/repos/nyasuto/beaver/issues/126",
  "repository_url": "https://api.github.com/repos/nyasuto/beaver",
  "labels_url": "https://api.github.com/repos/nyasuto/beaver/issues/126/labels{/name}",
  "comments_url": "https://api.github.com/repos/nyasuto/beaver/issues/126/comments",
  "events_url": "https://api.github.com/repos/nyasuto/beaver/issues/126/events"
}