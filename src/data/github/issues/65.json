{
  "id": 3215509163,
  "node_id": "PR_kwDOPJEskc6eGkyi",
  "number": 65,
  "title": "fix: GitHub Pages internal links missing base path causing 404 errors",
  "body": "## 概要\n\nGitHub Pages でのデプロイ時に内部リンクが 404 エラーになる問題を修正しました。\n\n## 問題の詳細\n\n### 現象\n- デプロイURL: `https://nyasuto.github.io/beaver/`\n- 内部リンクが `/issues` となり、実際のアクセスは `https://nyasuto.github.io/issues` (404エラー)\n- 正しくは `/beaver/issues` で `https://nyasuto.github.io/beaver/issues` である必要\n\n### 根本原因\n- Astro設定の `base: '/beaver'` は正しく設定済み\n- CSS/JSファイルは正しくプレフィックス付きで動作\n- **内部リンクのみ**がハードコードされており、ベースパスが不足していた\n\n## 修正内容\n\n### 1. URL ユーティリティ関数の実装\n```typescript\n// src/lib/utils/url.ts\nexport function resolveUrl(path: string): string {\n  const base = import.meta.env.BASE_URL || '/';\n  \n  // Development: /issues → /issues\n  // Production: /issues → /beaver/issues\n  if (base === '/') return path;\n  \n  const cleanBase = base.replace(/\\/$/, '');\n  const normalizedPath = path.startsWith('/') ? path : `/${path}`;\n  \n  return `${cleanBase}${normalizedPath}`;\n}\n```\n\n### 2. 内部リンクの修正 (30+ 箇所)\n- **Header.astro**: ナビゲーションメニューとロゴリンク (4箇所)\n- **Footer.astro**: プロダクトリンク (3箇所)\n- **index.astro**: メインページボタンとクイックアクション (6箇所)\n- **issues/index.astro**: パンくずリストとIssue詳細リンク (3箇所)\n- **issues/[id].astro**: パンくずリスト、リダイレクト、関連リンク (5箇所)\n- **analytics/index.astro**: パンくずリストとアクティビティリンク (3箇所)\n\n### 3. 変更例\n```typescript\n// Before (ハードコード)\nconst navItems = [\n  { name: 'Home', href: '/' },\n  { name: 'Issues', href: '/issues' },\n  { name: 'Analytics', href: '/analytics' },\n];\n\n// After (resolveUrl 使用)\nconst navItems = [\n  { name: 'Home', href: resolveUrl('/') },\n  { name: 'Issues', href: resolveUrl('/issues') },\n  { name: 'Analytics', href: resolveUrl('/analytics') },\n];\n```\n\n## 技術的詳細\n\n### 環境別動作\n- **開発環境**: `resolveUrl('/issues')` → `/issues` (変更なし)\n- **本番環境**: `resolveUrl('/issues')` → `/beaver/issues` (正しくプレフィックス)\n\n### 動作確認\n```bash\nnpm run build\n# 生成されたHTMLでの確認結果:\n# href=\"/beaver/issues\" ✅\n# href=\"/beaver/analytics\" ✅\n# href=\"/beaver/issues/new\" ✅\n```\n\n## テスト結果\n\n### ビルド成功\n- ✅ TypeScript 型チェック: 通過\n- ✅ ESLint/Prettier: 通過\n- ✅ 186 テスト: 通過 (2 skipped)\n- ✅ 静的サイト生成: 成功\n\n### URL生成確認\n- ✅ 開発環境での既存動作維持\n- ✅ 本番環境での正しいベースパス付与\n- ✅ 生成HTML内の全リンクが `/beaver/*` 形式\n\n## 影響範囲\n\n### 解決される問題\n- ✅ GitHub Pages でのナビゲーションリンク 404 エラー\n- ✅ パンくずリストリンク 404 エラー\n- ✅ クイックアクションボタン 404 エラー\n- ✅ 関連Issue リンク 404 エラー\n\n### 維持される機能\n- ✅ 開発環境での既存動作\n- ✅ 外部リンクへの影響なし\n- ✅ API エンドポイントへの影響なし\n\n## 今後の指針\n\nこの修正により、今後新しいページやコンポーネントを追加する際は：\n1. `import { resolveUrl } from '../lib/utils/url'` を追加\n2. ハードコードされた内部リンクを `resolveUrl()` でラップ\n3. 開発・本番両環境で適切に動作\n\nCloses #58\n\n🤖 Generated with [Claude Code](https://claude.ai/code)",
  "user": {
    "login": "nyasuto",
    "id": 17446383,
    "node_id": "MDQ6VXNlcjE3NDQ2Mzgz",
    "avatar_url": "https://avatars.githubusercontent.com/u/17446383?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nyasuto",
    "html_url": "https://github.com/nyasuto",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 8910603282,
      "node_id": "LA_kwDOPJEskc8AAAACEx0EEg",
      "name": "priority: high",
      "description": "High priority tasks",
      "color": "f85149",
      "default": false
    },
    {
      "id": 8910603467,
      "node_id": "LA_kwDOPJEskc8AAAACEx0Eyw",
      "name": "type: bug",
      "description": "Bug fix",
      "color": "d73a4a",
      "default": false
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 0,
  "created_at": "2025-07-09T10:57:49Z",
  "updated_at": "2025-07-09T10:59:09Z",
  "closed_at": "2025-07-09T10:59:07Z",
  "author_association": "OWNER",
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/nyasuto/beaver/pulls/65",
    "html_url": "https://github.com/nyasuto/beaver/pull/65",
    "diff_url": "https://github.com/nyasuto/beaver/pull/65.diff",
    "patch_url": "https://github.com/nyasuto/beaver/pull/65.patch"
  },
  "html_url": "https://github.com/nyasuto/beaver/pull/65",
  "url": "https://api.github.com/repos/nyasuto/beaver/issues/65",
  "repository_url": "https://api.github.com/repos/nyasuto/beaver",
  "labels_url": "https://api.github.com/repos/nyasuto/beaver/issues/65/labels{/name}",
  "comments_url": "https://api.github.com/repos/nyasuto/beaver/issues/65/comments",
  "events_url": "https://api.github.com/repos/nyasuto/beaver/issues/65/events"
}